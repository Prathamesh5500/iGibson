<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ROS Integration &mdash; iGibson 2.2.2 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tests and Examples" href="tests.html" />
    <link rel="prev" title="Learning Frameworks" href="learning_framework.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> iGibson
          </a>
              <div class="version">
                2.2.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">iGibson: the Interactive Gibson Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview of Modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="dataset.html">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="assets.html">Assets</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulators.html">Simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="extended_states.html">Extended States and Logic States</a></li>
<li class="toctree-l1"><a class="reference internal" href="renderer.html">Renderer</a></li>
<li class="toctree-l1"><a class="reference internal" href="viewer.html">Viewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="environments.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="scenes.html">Scenes</a></li>
<li class="toctree-l1"><a class="reference internal" href="objects.html">Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="robots.html">Robots</a></li>
<li class="toctree-l1"><a class="reference internal" href="sampling.html">Sampling Scene Instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_framework.html">Learning Frameworks</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">ROS Integration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-setup-without-docker-option-1">Environment Setup without docker (option 1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparation">Preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sanity-check">Sanity check</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-setup-with-docker-option-2">Environment Setup with docker (option 2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running">Running</a></li>
<li class="toctree-l2"><a class="reference internal" href="#topics">Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-new-robots">Adding New Robots</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Tests and Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Code Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="apidoc/modules.html">igibson</a></li>
</ul>
<p class="caption"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="issues.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Projects using Gibson/iGibson</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgments</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">iGibson</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>ROS Integration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/ros_integration.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="ros-integration">
<h1>ROS Integration<a class="headerlink" href="#ros-integration" title="Permalink to this headline"></a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="http://www.ros.org">ROS</a> is a set of well-engineered software libraries for building robotics applications. It includes a wide variety of packages, from low level drivers to efficient implementations of state of the art algorithms. As we strive to build intelligent agents and transfer them to real-world (on a real robot), we need to take advantage of ROS packages to complete the robot application pipeline.</p>
<p>There are three key applications of integrating iGibson with ROS.</p>
<ul class="simple">
<li><p>Benchmark existing algorithms in a controlled realistic simulation environment. This allows for comparing learning-based methods with classical methods in simulation environments.</p></li>
<li><p>Comparing robots in simulation with robots in the real world. In simulation, iGibson can simulate sensors of a robot and publish as messages. In the real world, a real robot publish sensor messages from onboard sensors. Therefore, it is possible to only change the message subscribed and benchmark the performance of downstream applications. This helps locate domain gap and debug algorithms.</p></li>
<li><p>Using ROS functions in simulation, such as many motion planning implementations.</p></li>
</ul>
<p>The possibility of using iGibson with ROS is unlimited. As a starter, we provide an example of integrating iGibson with ROS for navigation. This is a ROS package integrates iGibson Env with ROS navigation stack. It follows the same node topology and topics as <code class="docutils literal notranslate"><span class="pre">turtlebot_navigation</span></code> package. As shown below, so after a policy is trained in iGibson, it requires minimal changes to deploy onto a real turtlebot.</p>
<p><img alt="" src="_images/node_topo.jpg" /></p>
</div>
<div class="section" id="environment-setup-without-docker-option-1">
<h2>Environment Setup without docker (option 1)<a class="headerlink" href="#environment-setup-without-docker-option-1" title="Permalink to this headline"></a></h2>
<p>Using docker to install igibson-ros bridge is preferred. Setting up without docker has only been tested on limited system environments.</p>
</div>
<div class="section" id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline"></a></h2>
<ol class="arabic simple">
<li><p>Install ROS: in this package, we use navigation stack from ROS noetic. Please follow the <a class="reference external" href="http://wiki.ros.org/noetic/Installation/Ubuntu">instructions</a>.</p></li>
<li><p>Install iGibson <strong>from source</strong> following <a class="reference internal" href="installation.html"><span class="doc std std-doc">installation guide</span></a> with Python 3.8.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/StanfordVL/iGibson<span class="w"> </span>--recursive
<span class="nb">cd</span><span class="w"> </span>iGibson

<span class="c1"># if you didn&#39;t create the conda environment before:</span>
conda<span class="w"> </span>create<span class="w"> </span>-y<span class="w"> </span>-n<span class="w"> </span>igibson<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.8
conda<span class="w"> </span>activate<span class="w"> </span>igibson

pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.<span class="w"> </span><span class="c1"># This step takes about 4 minutes</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>tweak <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> as below. <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> need to contain four parts, in the exact order.</p></li>
<li><p>ROS python libraries: e.g. <code class="docutils literal notranslate"><span class="pre">/opt/ros/noetic/lib/python3/dist-packages</span></code></p></li>
<li><p>conda python libaries: e.g. <code class="docutils literal notranslate"><span class="pre">&lt;anaconda</span> <span class="pre">installation</span> <span class="pre">root&gt;/envs/igibson/lib/python3.8/site-packages</span></code>(iGibson dependencies)</p></li>
<li><p>iGibson libary: <code class="docutils literal notranslate"><span class="pre">&lt;iGibson</span> <span class="pre">root&gt;</span></code></p></li>
</ol>
<p>Note the PYTHONPATH need to have the exact order as specified above, otherwise there will be complaints about numpy versions.</p>
<ol class="arabic simple" start="4">
<li><p>Create <code class="docutils literal notranslate"><span class="pre">catkin_ws/src</span></code> folder</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/catkin_ws/src
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Soft-link <code class="docutils literal notranslate"><span class="pre">igibson-ros</span></code> folder to your <code class="docutils literal notranslate"><span class="pre">catkin_ws/src</span></code> and run <code class="docutils literal notranslate"><span class="pre">catkin_make</span></code> to index <code class="docutils literal notranslate"><span class="pre">igibson-ros</span></code> package.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/catkin_ws/src
ln<span class="w"> </span>-s<span class="w"> </span>$&lt;iGibson<span class="w"> </span>root&gt;/igibson/examples/ros/igibson-ros/<span class="w"> </span>.

<span class="nb">source</span><span class="w"> </span>/opt/ros/noetic/setup.bash<span class="w"> </span><span class="c1"># to setup ros environment</span>
<span class="nb">cd</span><span class="w"> </span>~/catkin_ws<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>catkin_make
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Install <code class="docutils literal notranslate"><span class="pre">igibson-ros</span></code> dependencies:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/catkin_ws
rosdep<span class="w"> </span>install<span class="w"> </span>--from-paths<span class="w"> </span>src<span class="w"> </span>--ignore-src<span class="w"> </span>-r<span class="w"> </span>-y
</pre></div>
</div>
</div>
<div class="section" id="sanity-check">
<h2>Sanity check<a class="headerlink" href="#sanity-check" title="Permalink to this headline"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>which<span class="w"> </span>python<span class="w"> </span><span class="c1"># Should give a python3 binary</span>
python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import igibson, rospy, rospkg&#39;</span><span class="w"> </span><span class="c1"># Should run without errors</span>
</pre></div>
</div>
</div>
<div class="section" id="environment-setup-with-docker-option-2">
<h2>Environment Setup with docker (option 2)<a class="headerlink" href="#environment-setup-with-docker-option-2" title="Permalink to this headline"></a></h2>
<p>Alternatively, you can put iGibson and ros both in docker, we have prepared the dockerfile to do it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/StanfordVL/iGibson<span class="w"> </span>--recursive

<span class="nb">cd</span><span class="w"> </span>iGibson/docker/igibson-ros

./build.sh
./run_gui.sh
</pre></div>
</div>
</div>
<div class="section" id="running">
<h2>Running<a class="headerlink" href="#running" title="Permalink to this headline"></a></h2>
<p>In order to run iGibson+ROS examples, you will need to perform the following steps:</p>
<ol class="arabic simple">
<li><p>Prepare ROS environment</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>/opt/ros/kinetic/setup.bash
<span class="nb">source</span><span class="w"> </span>~/catkin_ws/devel/setup.bash
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Repeat Step 3 from Preparation: sanitize <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code></p></li>
<li><p>Here are some of the examples that you can run, including gmapping, hector mapping and navigation.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roslaunch<span class="w"> </span>igibson-ros<span class="w"> </span>turtlebot_rgbd.launch<span class="w"> </span><span class="c1"># Bare minimal bringup example</span>
roslaunch<span class="w"> </span>igibson-ros<span class="w"> </span>turtlebot_gmapping.launch<span class="w"> </span><span class="c1"># Run gmapping</span>
roslaunch<span class="w"> </span>igibson-ros<span class="w"> </span>turtlebot_navigation.launch<span class="w"> </span><span class="c1"># Run the navigation stack, we have provided the map</span>
</pre></div>
</div>
<p>The following screenshot is captured when running the bare minimal bringup example.</p>
<p><img alt="" src="_images/sensing.png" /></p>
<p>The following screenshot is captured when running the gmapping example.</p>
<p><img alt="" src="_images/slam.png" /></p>
</div>
<div class="section" id="topics">
<h2>Topics<a class="headerlink" href="#topics" title="Permalink to this headline"></a></h2>
<p>Here are all the topics that <code class="docutils literal notranslate"><span class="pre">turtlebot_rgbd.py</span></code> publishes and subscribes.</p>
<p>Publishes:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">Topic name</th>
<th style="text-align: center;">Type</th>
<th style="text-align: center;">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>/gibson_ros/camera/depth/camera_info</code></td>
<td style="text-align: center;"><code>sensor_msgs/CameraInfo</code></td>
<td style="text-align: center;">Camera parameters used in iGibson, same for depth and rgb</td>
</tr>
<tr>
<td style="text-align: center;"><code>/gibson_ros/camera/rgb/image</code></td>
<td style="text-align: center;"><code>sensor_msgs/Image</code></td>
<td style="text-align: center;">RGB image captured in iGibson</td>
</tr>
<tr>
<td style="text-align: center;"><code>/gibson_ros/camera/rgb/depth</code></td>
<td style="text-align: center;"><code>sensor_msgs/Image</code></td>
<td style="text-align: center;">Depth image captured in iGibson, in meters, with dtype being float32</td>
</tr>
<tr>
<td style="text-align: center;"><code>/gibson_ros/camera/rgb/depth_raw</code></td>
<td style="text-align: center;"><code>sensor_msgs/Image</code></td>
<td style="text-align: center;">Depth image captured in iGibson, mimic raw depth data captured with OpenNI cameras, with dtype being uint16, see more <a href="http://www.ros.org/reps/rep-0118.html">here</a></td>
</tr>
<tr>
<td style="text-align: center;"><code>/gibson_ros/lidar/points</code></td>
<td style="text-align: center;"><code>sensor_msgs/PointCloud2</code></td>
<td style="text-align: center;">1-beam LiDAR scan captured in iGibson, in meters, with dtype being float32</td>
</tr>
<tr>
<td style="text-align: center;"><code>/odom</code></td>
<td style="text-align: center;"><code>nav_msgs/Odometry</code></td>
<td style="text-align: center;">The pose of <code>base_footprint</code> in <code>odom</code> frame, generated with groudtruth pose in iGibson</td>
</tr>
<tr>
<td style="text-align: center;"><code>/ground_truth_odom</code></td>
<td style="text-align: center;"><code>nav_msgs/Odometry</code></td>
<td style="text-align: center;">The pose of <code>base_footprint</code> in <code>world</code> frame, generated with groudtruth pose in iGibson</td>
</tr>
</tbody>
</table>
<p>Subscribes:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">Topic name</th>
<th style="text-align: center;">Type</th>
<th style="text-align: center;">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>/mobile_base/commands/velocity</code></td>
<td style="text-align: center;"><code>geometry_msgs/Twist</code></td>
<td style="text-align: center;">Velocity command for turtlebot, <code>msg.linear.x</code> is the forward velocity, <code>msg.angular.z</code> is the angular velocity</td>
</tr>
<tr>
<td style="text-align: center;"><code>/reset_pose</code></td>
<td style="text-align: center;"><code>geometry_msgs/PoseStamped</code></td>
<td style="text-align: center;">Direct reset turtlebot's pose (i.e. teleportation)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="adding-new-robots">
<h2>Adding New Robots<a class="headerlink" href="#adding-new-robots" title="Permalink to this headline"></a></h2>
<p>It should be relatively easy to support new robots with iGibson-ros bridge. First, you need to create a python file and a yaml file to run the robot in iGibson. As examples, please
refer to</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">iGibson/igibson/examples/ros/igibson-ros/turtlebot_rgbd.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iGibson/igibson/examples/ros/igibson-ros/turtlebot_rgbd.yaml</span></code></p></li>
</ul>
<p>Then you need to import the urdf files into ros. The robot urdf used in iGibson and used for ros might be slightly different, you need to choose the ones suitable for ros. As an example, please
refer to</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">iGibson/igibson/examples/ros/igibson-ros/turtlebot.urdf</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iGibson/igibson/examples/ros/igibson-ros/turtlebot/turtlebot_description</span></code></p></li>
</ul>
<p>These urdfs are referred to by launch files in <code class="docutils literal notranslate"><span class="pre">iGibson/igibson/examples/ros/igibson-ros/launch</span></code>. You need to create new launch files for new robots. Note that the example is for mobile robots, but for mobile manipulators you also need to publish joint states, which need to be added to the main python file.</p>
<div class="section" id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="http://wiki.ros.org/turtlebot_navigation/Tutorials/Setup%20the%20Navigation%20Stack%20for%20TurtleBot">Turtlebot Navigation stack</a></p></li>
<li><p><a class="reference external" href="http://wiki.ros.org/move_base"><code class="docutils literal notranslate"><span class="pre">Move_base</span></code> package</a></p></li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="learning_framework.html" class="btn btn-neutral float-left" title="Learning Frameworks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tests.html" class="btn btn-neutral float-right" title="Tests and Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Stanford University 2018-2021.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>